<div class="container-fluid">
  <h3 class="mb-4"><i class="bi bi-boxes"></i> Stock</h3>
  
  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible">
    {{ errorMessage }}
    <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
  </div>

  <!-- Items Per Page Control -->
  <div class="card mb-3">
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <label>Show 
            <select 
              class="form-select form-select-sm d-inline-block w-auto mx-2" 
              [(ngModel)]="itemsPerPage" 
              (change)="onItemsPerPageChange()">
              <option value="10">10</option>
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
            entries
          </label>
        </div>
        <div class="col-md-6 text-end">
          <label>Search: 
            <input 
              type="text" 
              class="form-control form-control-sm d-inline-block w-auto ms-2"
              [(ngModel)]="searchTerm"
              (keyup.enter)="onSearch()"
              placeholder="Search...">
          </label>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Stock Table -->
  <div class="card">
    <div class="table-responsive">
      <table class="table table-striped table-hover table-sm mb-0">
        <thead class="bg-primary text-white">
          <tr>
            <th width="60">NO</th>
            <th>MODEL</th>
            <th>COLOR</th>
            <th>SIZE</th>
            <th>BRAND</th>
            <th>ITEM</th>
            <th>PRODUCTION</th>
            <th>STATUS PRODUCTION</th>
            <th>PERCENT</th>
            <th>TOTAL</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of filteredStocks; let i = index">
            <td align="center">{{ ((currentPage - 1) * itemsPerPage) + i + 1 }}</td>
            <td>{{ item.model || '-' }}</td>
            <td>{{ item.color || '-' }}</td>
            <td align="center">{{ item.size || '-' }}</td>
            <td>{{ item.brand || '-' }}</td>
            <td>{{ item.item || '-' }}</td>
            <td>{{ item.production || '-' }}</td>
            <td align="center">
              <span 
                class="badge" 
                [ngClass]="getProductionStatusBadgeClass(item.status_production)">
                {{ item.status_production || 'N/A' }}
              </span>
            </td>
            <td align="center">
              <span class="badge bg-info">{{ item.percentage || 0 }}%</span>
            </td>
            <td align="center">
              <span class="badge bg-primary">{{ item.stock_akhir | number }}</span>
            </td>
          </tr>
          <tr *ngIf="filteredStocks.length === 0 && !isLoading">
            <td colspan="10" class="text-center text-muted py-4">
              <i class="bi bi-inbox fs-1 d-block mb-2"></i>
              {{ searchTerm ? 'No matching stock found' : 'No stock data available' }}
            </td>
          </tr>
          <tr *ngIf="isLoading">
            <td colspan="10" class="text-center text-muted py-4">
              <div class="spinner-border spinner-border-sm me-2"></div>
              Loading stock data...
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination Footer -->
    <div class="card-footer" *ngIf="totalPages > 0">
      <div class="row align-items-center">
        <div class="col-md-6">
          <small class="text-muted">
            Showing {{ ((currentPage - 1) * itemsPerPage) + 1 }} to 
            {{ Math.min(currentPage * itemsPerPage, totalItems) }} of 
            {{ totalItems }} entries
          </small>
        </div>
        <div class="col-md-6">
          <nav>
            <ul class="pagination pagination-sm justify-content-end mb-0">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a class="page-link" (click)="goToPage(1)" [class.disabled]="currentPage === 1">
                  Previous
                </a>
              </li>
              <li 
                class="page-item" 
                *ngFor="let page of pageNumbers" 
                [class.active]="page === currentPage">
                <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
              </li>
              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <a class="page-link" (click)="goToPage(currentPage + 1)">
                  Next
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>